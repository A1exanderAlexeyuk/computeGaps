% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_prevalence_from_spec_df.R
\name{compute_prevalence_from_spec_df}
\alias{compute_prevalence_from_spec_df}
\title{Compute prevalence from an in-memory spec tibble (tibble-only output, no DB writes)}
\usage{
compute_prevalence_from_spec_df(
  conn,
  cdm_schema,
  cohort_schema,
  cohort_table,
  spec_df,
  cohort_definition_id = NULL,
  restrict_to_observation_period = FALSE
)
}
\arguments{
\item{conn}{DatabaseConnector connection (OHDSI DatabaseConnector)}

\item{cdm_schema}{CDM schema name (e.g., "omop_cdm")}

\item{cohort_schema}{Schema that contains the cohort table}

\item{cohort_table}{Cohort table name (columns: subject_id, cohort_start_date [, cohort_definition_id])}

\item{spec_df}{Data frame/tibble with columns:
  cohortname, concept_id_1, relationship_id, concept_id_2,
  omop_object_domain, object_custom_name, object_custom_code, predicate_metadata (JSON)}

\item{cohort_definition_id}{Optional integer. If provided, filters cohort table by this ID}

\item{restrict_to_observation_period}{Logical. If TRUE, enforces that domain event dates fall within observation_period}
}
\value{
 tibble with columns:
  cohortname, omop_object_domain, object_custom_name, `Workflow stage`,
  patient_count, n_patients, n_patients_with_op
}
\description{
This function accepts a preloaded spec data.frame/tibble with the columns:
cohortname, concept_id_1, relationship_id, concept_id_2, omop_object_domain,
object_custom_name, object_custom_code, predicate_metadata (JSON), and computes
the prevalence of concept_id_2 events in the appropriate OMOP domain tables
within the specified time window around cohort_start_date. It performs only
read queries against the database and returns a tibble; it does not write to DB.
}
\details{
The output columns match:
\itemize{
\item cohortname
\item omop_object_domain
\item object_custom_name
\item Workflow stage (from predicate_metadata)
\item patient_count (distinct patients with at least one qualifying record)
\item n_patients (distinct patients in the cohort table after optional filtering)
\item n_patients_with_op (alias of patient_count)
}
}
